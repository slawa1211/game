<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dodge & Collect — Game Web</title>
  <style>
    :root{
      --bg: #0f1226; /* gelap biru */
      --card: #161a36;
      --acc: #6ee7ff;
      --acc2:#a78bfa;
      --good:#34d399;
      --bad:#f43f5e;
      --text:#e5e7eb;
      --muted:#9ca3af;
      --shadow: 0 10px 25px rgba(0,0,0,.35);
      --radius: 18px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background: radial-gradient(1200px 700px at 20% 10%, #1b1f45 0%, #0f1226 60%, #0a0c1a 100%);
      color:var(--text); font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Inter, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
      display:flex; align-items:center; justify-content:center; padding:16px;
      overflow:hidden;
    }
    .shell{width:100%; max-width:980px; display:grid; gap:16px}
    .topbar{
      display:flex; align-items:center; justify-content:space-between; gap:12px; flex-wrap:wrap;
      background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      border:1px solid rgba(255,255,255,.08);
      border-radius:var(--radius);
      padding:10px 14px; box-shadow:var(--shadow);
      backdrop-filter: blur(8px);
    }
    .brand{display:flex; gap:10px; align-items:center}
    .logo{width:34px; height:34px; border-radius:10px; background:linear-gradient(135deg,var(--acc),var(--acc2)); box-shadow:0 6px 18px rgba(167,139,250,.35)}
    .brand h1{font-size:18px; margin:0}

    .tags{display:flex; gap:8px; flex-wrap:wrap}
    .tag{padding:6px 10px; border-radius:999px; border:1px solid rgba(255,255,255,.14); color:var(--muted); font-size:12px}

    .panel{display:grid; grid-template-columns: 1fr; gap:16px}

    .hud{
      display:flex; gap:12px; align-items:center; justify-content:space-between; flex-wrap:wrap;
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      border:1px solid rgba(255,255,255,.08);
      border-radius:var(--radius); padding:12px 14px; box-shadow:var(--shadow);
    }
    .hud .group{display:flex; gap:14px; align-items:center; flex-wrap:wrap}
    .pill{display:flex; gap:8px; align-items:center; padding:6px 10px; border-radius:999px; background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.08); font-size:13px}
    .dot{width:10px; height:10px; border-radius:50%}
    .dot.good{background:var(--good)}
    .dot.bad{background:var(--bad)}

    .wrap{
      position:relative; background: linear-gradient(180deg, #0b0e1f, #0b0c19);
      border-radius: var(--radius); border:1px solid rgba(255,255,255,.08); box-shadow: var(--shadow);
      aspect-ratio: 16/9; min-height: 460px; max-height: 70vh; overflow:hidden;
    }

    canvas{position:absolute; inset:0; width:100%; height:100%}

    .overlay{position:absolute; inset:0; display:grid; place-items:center; padding:20px}
    .card{
      width:min(520px, 92%);
      background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.03));
      border:1px solid rgba(255,255,255,.12); border-radius: calc(var(--radius) + 6px);
      padding:20px; text-align:center; box-shadow:var(--shadow);
      backdrop-filter: blur(6px);
    }
    .title{font-size:28px; margin:6px 0 12px}
    .desc{color:var(--muted); margin:0 0 14px}

    .btns{display:flex; gap:10px; justify-content:center; flex-wrap:wrap}
    .btn{appearance:none; border:0; cursor:pointer; border-radius:14px; padding:10px 14px; font-weight:600; box-shadow:var(--shadow)}
    .btn.primary{background:linear-gradient(135deg, var(--acc), var(--acc2)); color:#0b0d1c}
    .btn.ghost{background:transparent; border:1px solid rgba(255,255,255,.16); color:var(--text)}

    .keys{display:grid; grid-template-columns: repeat(3, minmax(80px,1fr)); gap:10px; margin-top:10px}
    .key{border:1px solid rgba(255,255,255,.12); padding:10px; border-radius:12px; color:var(--muted)}

    .toast{position:absolute; left:12px; bottom:12px; padding:8px 12px; border-radius:12px; font-size:13px; background:rgba(0,0,0,.4); border:1px solid rgba(255,255,255,.12)}

    /* Mobile controls */
    .pad{position:absolute; right:16px; bottom:16px; display:none; gap:10px}
    .pad .circle{width:58px; height:58px; border-radius:50%; border:1px solid rgba(255,255,255,.14); background:rgba(255,255,255,.06); display:grid; place-items:center; user-select:none}
    .pad .circle:active{transform:scale(.96)}

    @media (max-width: 860px){
      .pad{display:flex}
    }
  </style>
</head>
<body>
  <div class="shell">
    <div class="topbar">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <h1>Dodge & Collect</h1>
      </div>
      <div class="tags">
        <div class="tag">HTML + CSS + JS</div>
        <div class="tag">Keyboard & Sentuh</div>
        <div class="tag">Simpan Skor</div>
      </div>
    </div>

    <div class="panel">
      <div class="hud">
        <div class="group">
          <div class="pill" id="scorePill">Skor: <strong id="score">0</strong></div>
          <div class="pill">Level: <strong id="level">1</strong></div>
          <div class="pill">Nyawa: <strong id="lives">3</strong></div>
          <div class="pill">Best: <strong id="best">0</strong></div>
        </div>
        <div class="group">
          <button class="btn ghost" id="toggleSound" aria-pressed="false">Suara: OFF</button>
          <button class="btn ghost" id="pauseBtn">Jeda</button>
          <button class="btn ghost" id="restartBtn">Ulang</button>
        </div>
      </div>

      <div class="wrap">
        <canvas id="game"></canvas>

        <div class="overlay" id="menu">
          <div class="card">
            <div class="title">Selamat Datang!</div>
            <p class="desc">Gerakkan pemain untuk <b>menghindari rintangan merah</b> dan <b>mengambil orbs hijau</b>. Kumpulkan skor setinggi mungkin.</p>
            <div class="btns"><button class="btn primary" id="playBtn">Mulai Main</button></div>
            <div class="keys">
              <div class="key">W / ⬆️ : Naik</div>
              <div class="key">A / ⬅️ : Kiri</div>
              <div class="key">S / ⬇️ : Turun</div>
              <div class="key">D / ➡️ : Kanan</div>
              <div class="key">Spasi : Jeda</div>
              <div class="key">Sentuh: Tombol bulat</div>
            </div>
          </div>
        </div>

        <div class="overlay" id="gameOver" style="display:none">
          <div class="card">
            <div class="title">Game Over</div>
            <p class="desc">Skor kamu: <b id="finalScore">0</b> • Level: <b id="finalLevel">1</b></p>
            <div class="btns">
              <button class="btn primary" id="againBtn">Main Lagi</button>
              <button class="btn ghost" id="shareBtn">Bagikan</button>
            </div>
          </div>
        </div>

        <div class="toast" id="toast" style="display:none">Paused</div>

        <div class="pad" aria-label="Kontrol Sentuh">
          <div class="circle" data-dir="up">⬆️</div>
          <div class="circle" data-dir="left">⬅️</div>
          <div class="circle" data-dir="down">⬇️</div>
          <div class="circle" data-dir="right">➡️</div>
        </div>
      </div>
    </div>
  </div>

  <audio id="sndCollect" preload="auto">
    <source src="data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAESsAACJWAAACABYBWFlaAAABAACAgICA" type="audio/wav" />
  </audio>
  <audio id="sndHit" preload="auto">
    <source src="data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAESsAACJWAAACABYBWFlaAAABAACAgICA" type="audio/wav" />
  </audio>

  <script>
  (()=>{
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');

    // Resize canvas to fit element size
    function fit(){
      const r = canvas.getBoundingClientRect();
      const dpr = Math.min(2, window.devicePixelRatio || 1);
      canvas.width = Math.floor(r.width * dpr);
      canvas.height = Math.floor(r.height * dpr);
      ctx.setTransform(dpr,0,0,dpr,0,0);
    }
    addEventListener('resize', fit, {passive:true});
    fit();

    // Game state
    const state = {
      running:false,
      paused:false,
      frame:0,
      level:1,
      score:0,
      lives:3,
      best: Number(localStorage.getItem('dc_best')||0),
      sound:false
    };

    // Entities
    const player = {x:120, y:120, r:14, vx:0, vy:0, speed:3.4, max:5.4};
    const orbs = [];
    const hazards = [];

    const UI = {
      score: document.getElementById('score'),
      level: document.getElementById('level'),
      lives: document.getElementById('lives'),
      best: document.getElementById('best'),
      menu: document.getElementById('menu'),
      over: document.getElementById('gameOver'),
      finalScore: document.getElementById('finalScore'),
      finalLevel: document.getElementById('finalLevel'),
      toast: document.getElementById('toast')
    };
    UI.best.textContent = state.best;

    const sndCollect = document.getElementById('sndCollect');
    const sndHit = document.getElementById('sndHit');

    // Controls
    const keys = new Set();
    addEventListener('keydown', e=>{
      if(['ArrowUp','ArrowDown','ArrowLeft','ArrowRight',' ','Space','w','a','s','d','W','A','S','D'].includes(e.key)) e.preventDefault();
      if(e.key===' ') togglePause();
      keys.add(e.key.toLowerCase());
    }, {passive:false});
    addEventListener('keyup', e=> keys.delete(e.key.toLowerCase()));

    document.querySelectorAll('.pad .circle').forEach(btn=>{
      const dir = btn.dataset.dir;
      const map = {up:'w',down:'s',left:'a',right:'d'};
      const k = map[dir];
      const press = ()=>{ keys.add(k); setTimeout(()=>keys.delete(k), 120); };
      btn.addEventListener('touchstart', e=>{ e.preventDefault(); press(); }, {passive:false});
      btn.addEventListener('click', press);
    });

    // Buttons
    document.getElementById('playBtn').onclick = start;
    document.getElementById('againBtn').onclick = ()=>{ hide(UI.over); start(); };
    document.getElementById('restartBtn').onclick = ()=>{ start(); };
    document.getElementById('pauseBtn').onclick = ()=> togglePause();
    document.getElementById('toggleSound').onclick = (e)=>{
      state.sound = !state.sound; e.target.setAttribute('aria-pressed', state.sound);
      e.target.textContent = 'Suara: ' + (state.sound? 'ON':'OFF');
    };
    document.getElementById('shareBtn').onclick = share;

    function show(el){ el.style.display='grid'; }
    function hide(el){ el.style.display='none'; }

    function start(){
      // reset
      state.running = true; state.paused=false; state.frame=0; state.level=1; state.score=0; state.lives=3;
      player.x = canvas.width/2/ (window.devicePixelRatio||1); player.y = canvas.height/2/ (window.devicePixelRatio||1);
      player.vx = player.vy = 0;
      orbs.length=0; hazards.length=0;
      spawnInitial();
      hide(UI.menu); hide(UI.over); UI.toast.style.display='none';
      loop();
    }

    function gameOver(){
      state.running=false;
      UI.finalScore.textContent = state.score;
      UI.finalLevel.textContent = state.level;
      if(state.score>state.best){ state.best=state.score; localStorage.setItem('dc_best', String(state.best)); }
      UI.best.textContent = state.best;
      show(UI.over);
    }

    function togglePause(){
      if(!state.running) return;
      state.paused = !state.paused;
      UI.toast.textContent = state.paused? 'Jeda':'Lanjut';
      UI.toast.style.display = 'block';
      clearTimeout(togglePause._t); togglePause._t=setTimeout(()=> UI.toast.style.display='none', 800);
    }

    function share(){
      const text = `Aku baru dapat skor ${state.score} di Dodge & Collect! 🎮 Level ${state.level}. Coba kalahkan skor-ku!`;
      if(navigator.share){ navigator.share({title:'Dodge & Collect', text}); }
      else { navigator.clipboard.writeText(text); alert('Teks skor disalin, tinggal tempel di media sosial!'); }
    }

    // Spawning logic
    function spawnInitial(){
      for(let i=0;i<6;i++) spawnOrb();
      for(let i=0;i<3;i++) spawnHazard();
    }
    function spawnOrb(){
      const w = canvas.clientWidth, h = canvas.clientHeight; // CSS pixels
      orbs.push({x: rand(24, w-24), y: rand(24, h-24), r: 10, vx: rand(-1.5, 1.5), vy: rand(-1.5,1.5)});
    }
    function spawnHazard(){
      const w = canvas.clientWidth, h = canvas.clientHeight;
      const speed = rand(1.2, 2.2) + state.level*0.15;
      const angle = Math.random()*Math.PI*2;
      hazards.push({x: rand(24, w-24), y: rand(24, h-24), r: 14, vx: Math.cos(angle)*speed, vy: Math.sin(angle)*speed});
    }

    // Helpers
    function rand(a,b){ return a + Math.random()*(b-a); }
    function clamp(v,a,b){ return Math.max(a, Math.min(b, v)); }
    function dist(a,b){ const dx=a.x-b.x, dy=a.y-b.y; return Math.hypot(dx,dy); }

    // Loop
    function loop(){
      if(!state.running) return;
      requestAnimationFrame(loop);
      if(state.paused) return;
      state.frame++;

      // Update difficulty
      if(state.frame % 600 === 0){ // tiap 10 detik @60fps
        state.level++; spawnHazard(); spawnHazard();
      }

      // Move player
      const accel = 0.5;
      if(keys.has('w') || keys.has('arrowup')) player.vy -= accel;
      if(keys.has('s') || keys.has('arrowdown')) player.vy += accel;
      if(keys.has('a') || keys.has('arrowleft')) player.vx -= accel;
      if(keys.has('d') || keys.has('arrowright')) player.vx += accel;
      // friction
      player.vx *= 0.92; player.vy *= 0.92;
      const spd = Math.hypot(player.vx, player.vy);
      if(spd > player.max){ player.vx = player.vx/spd*player.max; player.vy = player.vy/spd*player.max; }

      player.x += player.vx; player.y += player.vy;
      const w = canvas.clientWidth, h = canvas.clientHeight;
      player.x = clamp(player.x, player.r, w-player.r);
      player.y = clamp(player.y, player.r, h-player.r);

      // Move orbs & hazards (bounce di tepi)
      for(const o of orbs){ o.x += o.vx; o.y += o.vy; if(o.x<o.r||o.x>w-o.r) o.vx*=-1; if(o.y<o.r||o.y>h-o.r) o.vy*=-1; }
      for(const hz of hazards){ hz.x += hz.vx; hz.y += hz.vy; if(hz.x<hz.r||hz.x>w-hz.r) hz.vx*=-1; if(hz.y<hz.r||hz.y>h-hz.r) hz.vy*=-1; }

      // Collisions
      for(let i=orbs.length-1;i>=0;i--){
        if(dist(player, orbs[i]) < player.r + orbs[i].r){
          orbs.splice(i,1); state.score+=10; UI.score.textContent = state.score; if(state.sound) playSafe(sndCollect); spawnOrb();
        }
      }
      for(let i=hazards.length-1;i>=0;i--){
        if(dist(player, hazards[i]) < player.r + hazards[i].r){
          hazards.splice(i,1); state.lives--; UI.lives.textContent = state.lives; flash('#f43f5e'); if(state.sound) playSafe(sndHit);
          // knockback
          player.vx *= -0.6; player.vy *= -0.6; spawnHazard();
          if(state.lives<=0) return gameOver();
        }
      }

      // Add small passive score
      if(state.frame%30===0){ state.score++; UI.score.textContent = state.score; }

      // Render
      render();
    }

    function render(){
      const w = canvas.clientWidth, h=canvas.clientHeight;
      ctx.clearRect(0,0,canvas.width,canvas.height);

      // Background grid
      ctx.save();
      ctx.globalAlpha = .12;
      const step=32; ctx.beginPath();
      for(let x=0;x<w;x+=step){ ctx.moveTo(x,0); ctx.lineTo(x,h); }
      for(let y=0;y<h;y+=step){ ctx.moveTo(0,y); ctx.lineTo(w,y); }
      ctx.strokeStyle = '#9ca3af'; ctx.stroke();
      ctx.restore();

      // Orbs (good)
      for(const o of orbs){
        drawGlowCircle(o.x, o.y, o.r+8, 'rgba(52,211,153,.25)');
        drawCircle(o.x, o.y, o.r, '#34d399');
      }
      // Hazards (bad)
      for(const hz of hazards){
        drawGlowCircle(hz.x, hz.y, hz.r+8, 'rgba(244,63,94,.22)');
        drawCircle(hz.x, hz.y, hz.r, '#f43f5e');
      }
      // Player
      drawGlowCircle(player.x, player.y, player.r+10, 'rgba(110,231,255,.25)');
      drawCircle(player.x, player.y, player.r, '#6ee7ff');

      // HUD gradient vignette
      const grd = ctx.createRadialGradient(w/2,h/2,10,w/2,h/2, Math.max(w,h));
      grd.addColorStop(0,'rgba(255,255,255,0)');
      grd.addColorStop(1,'rgba(0,0,0,.25)');
      ctx.fillStyle = grd; ctx.fillRect(0,0,w,h);

      UI.level.textContent = state.level;
    }

    function drawCircle(x,y,r,color){
      ctx.beginPath(); ctx.arc(x,y,r,0,Math.PI*2);
      ctx.fillStyle = color; ctx.fill();
    }
    function drawGlowCircle(x,y,r,color){
      ctx.save(); ctx.fillStyle=color; ctx.beginPath(); ctx.arc(x,y,r,0,Math.PI*2); ctx.fill(); ctx.restore();
    }

    function flash(color){
      const el = document.querySelector('.wrap');
      const prev = el.style.boxShadow;
      el.style.boxShadow = `0 0 0 4px ${color}33, var(--shadow)`;
      setTimeout(()=> el.style.boxShadow = prev, 180);
    }

    function playSafe(audio){
      try{ audio.currentTime=0; audio.volume=.6; audio.play(); }catch(e){}
    }

    // Pause with spacebar only when game already started
    document.addEventListener('keydown', (e)=>{
      if(e.code==='Space') e.preventDefault();
    }, {passive:false});

  })();
  </script>
</body>
</html>
