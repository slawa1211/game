<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Math Puzzle ‚Äî Game Hitung & Teka-teki</title>
  <style>
    :root{
      --bg:#0b1020; --panel:#121733; --muted:#a3adc2; --text:#e8ecf8; --brand:#7dd3fc; --brand2:#a78bfa;
      --ok:#22c55e; --warn:#f59e0b; --bad:#ef4444; --radius:18px; --shadow:0 10px 25px rgba(0,0,0,.4)
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0; background:radial-gradient(1200px 700px at 15% 10%, #1a2150 0%, #0b1020 60%, #070a16 100%);
      color:var(--text); font-family:Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial;
      display:flex; align-items:center; justify-content:center; padding:16px}

    .app{width:100%; max-width:980px; display:grid; gap:16px}
    .topbar{display:flex; justify-content:space-between; align-items:center; gap:12px; flex-wrap:wrap;
      background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02)); border:1px solid rgba(255,255,255,.1);
      padding:10px 14px; border-radius:var(--radius); backdrop-filter: blur(6px); box-shadow:var(--shadow)}
    .brand{display:flex; gap:10px; align-items:center}
    .logo{width:34px; height:34px; border-radius:12px; background:linear-gradient(135deg,var(--brand),var(--brand2)); box-shadow:0 8px 20px rgba(167,139,250,.35)}
    h1{font-size:18px; margin:0}
    .top-actions{display:flex; gap:8px; flex-wrap:wrap}
    .btn{appearance:none; border:1px solid rgba(255,255,255,.14); background:rgba(255,255,255,.06); color:var(--text);
      padding:8px 12px; border-radius:12px; cursor:pointer; box-shadow:var(--shadow)}
    .btn.primary{border:none; background:linear-gradient(135deg,var(--brand),var(--brand2)); color:#0b0f1c; font-weight:700}

    .panel{display:grid; grid-template-columns:1fr; gap:16px}
    .hud{display:flex; align-items:center; justify-content:space-between; gap:12px; flex-wrap:wrap;
      background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02)); border:1px solid rgba(255,255,255,.1);
      padding:12px 14px; border-radius:var(--radius)}
    .pill{display:flex; align-items:center; gap:8px; padding:6px 10px; border:1px solid rgba(255,255,255,.12); border-radius:999px; background:rgba(255,255,255,.06)}
    .value{font-weight:700}

    .wrap{position:relative; background:linear-gradient(180deg,#0c1026,#0b0f24); border-radius:var(--radius); border:1px solid rgba(255,255,255,.1); box-shadow:var(--shadow); overflow:hidden}

    .screen{min-height:460px; display:grid; place-items:center; padding:24px}

    .card{width:min(780px,96%); text-align:center; background:linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.03)); border:1px solid rgba(255,255,255,.12);
      border-radius:calc(var(--radius) + 6px); padding:18px}

    .modes{display:grid; grid-template-columns:repeat(auto-fit, minmax(180px,1fr)); gap:12px; margin:12px 0}
    .mode{padding:14px; border:1px solid rgba(255,255,255,.14); border-radius:14px; background:rgba(255,255,255,.06); cursor:pointer}
    .mode:hover{transform:translateY(-2px)}

    .question{font-size:44px; line-height:1.1; letter-spacing:1px; margin:10px 0 4px}
    .sub{color:var(--muted); margin:6px 0 14px}

    .answer-wrap{display:grid; gap:10px; justify-items:center}
    .input{font-size:28px; padding:10px 12px; border-radius:12px; border:1px solid rgba(255,255,255,.16); background:rgba(255,255,255,.08); color:var(--text); width:min(360px, 90%); text-align:center}
    .choices{display:grid; grid-template-columns: repeat(auto-fit, minmax(120px,1fr)); gap:10px; width:min(600px,95%); margin-top:8px}
    .choice{padding:10px; border-radius:12px; border:1px solid rgba(255,255,255,.16); background:rgba(255,255,255,.06); cursor:pointer}
    .choice.correct{outline:3px solid var(--ok)}
    .choice.wrong{outline:3px solid var(--bad)}

    .result{font-size:14px; color:var(--muted); min-height:20px}
    .progress{height:10px; width:100%; background:rgba(255,255,255,.08); border-radius:999px; overflow:hidden; margin-top:10px}
    .bar{height:100%; width:100%; background:linear-gradient(90deg,var(--brand),var(--brand2))}

    .foot{display:flex; justify-content:center; gap:10px; flex-wrap:wrap; margin-top:12px}

    .toast{position:absolute; left:12px; bottom:12px; padding:8px 12px; border-radius:12px; font-size:13px; background:rgba(0,0,0,.45); border:1px solid rgba(255,255,255,.12)}

    @media (max-width:560px){
      .question{font-size:34px}
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="topbar">
      <div class="brand"><div class="logo"></div><h1>Math Puzzle</h1></div>
      <div class="top-actions">
        <button class="btn" id="toggleSound" aria-pressed="false">Suara: OFF</button>
        <button class="btn" id="toggleMode">Mode: Isian</button>
        <button class="btn" id="howBtn">Cara Main</button>
        <button class="btn primary" id="playBtn">Mulai ‚ñ∂</button>
      </div>
    </div>

    <div class="panel">
      <div class="hud">
        <div class="pill">Skor: <span class="value" id="score">0</span></div>
        <div class="pill">Streak: <span class="value" id="streak">0</span></div>
        <div class="pill">Sisa: <span class="value" id="time">60</span> dtk</div>
        <div class="pill">Best: <span class="value" id="best">0</span></div>
        <div class="pill">Kesulitan:
          <select id="difficulty" class="btn" style="padding:6px 8px">
            <option value="1">Mudah</option>
            <option value="2">Sedang</option>
            <option value="3">Sulit</option>
          </select>
        </div>
        <div class="pill">Jenis Soal:
          <select id="type" class="btn" style="padding:6px 8px">
            <option value="mix">Campuran</option>
            <option value="add">Penjumlahan</option>
            <option value="sub">Pengurangan</option>
            <option value="mul">Perkalian</option>
            <option value="eqx">Cari x (persamaan)</option>
            <option value="cmp">Bandingkan (>,<,=)</option>
          </select>
        </div>
      </div>

      <div class="wrap">
        <div class="screen" id="menu">
          <div class="card">
            <h2 style="margin:6px 0 10px">Selamat Datang üëã</h2>
            <p class="sub">Jawab sebanyak mungkin dalam 60 detik. Pilih jenis soal & tingkat kesulitan, lalu klik <b>Mulai</b>.</p>
            <div class="modes">
              <div class="mode"><b>Isian</b><br/>Ketik jawaban di kolom.</div>
              <div class="mode"><b>Pilihan</b><br/>Pilih 1 dari 4 opsi.</div>
              <div class="mode"><b>Campuran</b><br/>Soal acak berbagai tipe.</div>
            </div>
            <button class="btn primary" id="startBtn">Mulai Sekarang</button>
          </div>
        </div>

        <div class="screen" id="game" style="display:none">
          <div class="card">
            <div class="question" id="q"></div>
            <div class="sub" id="hint"></div>
            <div class="answer-wrap">
              <input id="answer" class="input" type="text" placeholder="Ketik jawaban‚Ä¶" autocomplete="off" />
              <div class="choices" id="choices" style="display:none"></div>
              <div class="foot">
                <button class="btn" id="skipBtn">Lewati (‚àí1)</button>
                <button class="btn" id="pauseBtn">Jeda</button>
                <button class="btn" id="restartBtn">Ulang</button>
              </div>
              <div class="progress"><div class="bar" id="bar"></div></div>
              <div class="result" id="result"></div>
            </div>
          </div>
          <div class="toast" id="toast" style="display:none"></div>
        </div>

        <div class="screen" id="over" style="display:none">
          <div class="card">
            <h2>Waktu Habis ‚è±Ô∏è</h2>
            <p class="sub">Skor: <b id="finalScore">0</b> ‚Ä¢ Streak Maks: <b id="finalStreak">0</b></p>
            <div class="foot"><button class="btn primary" id="againBtn">Main Lagi</button>
              <button class="btn" id="shareBtn">Bagikan</button></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <audio id="sndGood"><source src="data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAESsAACJWAAACABYBWFlaAAABAACAgICA" type="audio/wav"></audio>
  <audio id="sndBad"><source src="data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAESsAACJWAAACABYBWFlaAAABAACAgICA" type="audio/wav"></audio>

  <script>
  (()=>{
    const $ = sel => document.querySelector(sel);
    const UI = {
      score: $('#score'), streak: $('#streak'), time: $('#time'), best: $('#best'),
      q: $('#q'), hint: $('#hint'), ans: $('#answer'), choices: $('#choices'), res: $('#result'), bar: $('#bar'), toast: $('#toast'),
      menu: $('#menu'), game: $('#game'), over: $('#over'), finalScore: $('#finalScore'), finalStreak: $('#finalStreak')
    };

    const controls = {
      startBtn: $('#startBtn'), playBtn: $('#playBtn'), againBtn: $('#againBtn'), restartBtn: $('#restartBtn'),
      pauseBtn: $('#pauseBtn'), skipBtn: $('#skipBtn'), shareBtn: $('#shareBtn'), howBtn: $('#howBtn'),
      diff: $('#difficulty'), type: $('#type'), toggleSound: $('#toggleSound'), toggleMode: $('#toggleMode')
    };

    const sndGood = $('#sndGood'), sndBad = $('#sndBad');

    const state = {
      running:false, paused:false, t:60, score:0, streak:0, best:Number(localStorage.getItem('mp_best')||0),
      mode:'input', // input | choice
      kind:'mix', difficulty:1, sound:false,
      current:null, timer:null
    };

    UI.best.textContent = state.best;

    // ===== Helpers =====
    const rand = (a,b)=> a + Math.floor(Math.random()*(b-a+1));
    const pick = arr => arr[Math.floor(Math.random()*arr.length)];

    function show(el){ el.style.display='grid'; }
    function hide(el){ el.style.display='none'; }

    function toast(msg){ UI.toast.textContent=msg; UI.toast.style.display='block'; clearTimeout(toast._t); toast._t=setTimeout(()=>UI.toast.style.display='none', 900); }

    // ===== Question Generators =====
    function genNumbers(range){
      const r = {1:[0,9], 2:[5,25], 3:[12,60]}[state.difficulty];
      return [rand(r[0], r[1]), rand(r[0], r[1])];
    }

    function build(){
      const kind = state.kind==='mix'? pick(['add','sub','mul','eqx','cmp']): state.kind;
      const [a,b] = genNumbers();
      let q, answer, hint='';
      if(kind==='add'){ q = `${a} + ${b} = ?`; answer = a+b; hint = 'Jumlahkan kedua bilangan.'; }
      else if(kind==='sub'){ q = `${a} ‚àí ${b} = ?`; answer = a-b; hint = 'Kurangi bilangan pertama dengan kedua.'; }
      else if(kind==='mul'){
        const m1 = state.difficulty===1? rand(0,9): a; const m2 = state.difficulty===1? rand(0,9): b;
        q = `${m1} √ó ${m2} = ?`; answer = m1*m2; hint = 'Perkalian.';
      }
      else if(kind==='eqx'){
        // bentuk: a + x = b  atau  x ‚àí a = b
        if(Math.random()<0.5){ const rhs = a+b; q = `${a} + x = ${rhs}`; answer = b; hint='Cari nilai x.'; }
        else { const rhs = b-a; q = `x ‚àí ${a} = ${rhs}`; answer = b; hint='Pindah ruas untuk temukan x.'; }
      }
      else if(kind==='cmp'){
        const left = rand(0,50) + a, right = rand(0,50) + b;
        const comp = left===right? '=' : (left>right? '>' : '<');
        q = `${left} ? ${right}`; answer = comp; hint='Pilih tanda yang benar.';
      }
      return {kind, q, answer, hint};
    }

    function renderQuestion(){
      state.current = build();
      UI.q.textContent = state.current.q; UI.hint.textContent = state.current.hint; UI.res.textContent='';
      UI.ans.value=''; UI.ans.style.outline='none';

      if(state.mode==='choice' || state.current.kind==='cmp'){
        UI.choices.style.display='grid'; UI.ans.style.display = state.current.kind==='cmp'? 'none':'none';
        UI.choices.innerHTML='';
        let options = [];
        if(state.current.kind==='cmp'){
          options = ['>','<','='];
        } else {
          const correct = state.current.answer;
          options = [correct];
          while(options.length<4){
            const delta = rand(-9,9) || rand(2,6);
            const fake = correct + delta;
            if(!options.includes(fake)) options.push(fake);
          }
          options.sort(()=>Math.random()-0.5);
        }
        for(const opt of options){
          const btn = document.createElement('button'); btn.className='choice'; btn.textContent=String(opt);
          btn.onclick = ()=> submit(opt);
          UI.choices.appendChild(btn);
        }
      } else {
        UI.choices.style.display='none'; UI.ans.style.display='block'; UI.ans.focus();
      }
    }

    function submit(val){
      const correct = String(state.current.answer);
      const given = String(val ?? UI.ans.value.trim());
      if(!given){ toast('Isi jawabannya dulu ya'); return; }

      const isRight = given === correct;
      feedback(isRight);
      if(isRight){
        state.score += 5 + Math.min(15, state.streak); // bonus dari streak
        state.streak++;
        if(state.sound) play(sndGood);
      } else {
        state.score = Math.max(0, state.score-1);
        state.streak = 0;
        if(state.sound) play(sndBad);
      }
      UI.score.textContent = state.score; UI.streak.textContent = state.streak;
      renderQuestion();
    }

    function feedback(ok){
      UI.res.textContent = ok? 'Benar! üéâ' : `Salah. Jawaban: ${state.current.answer}`;
      flash(ok? 'var(--ok)':'var(--bad)');
      if(state.mode==='choice'){
        [...UI.choices.children].forEach(c=>{
          if(c.textContent===String(state.current.answer)) c.classList.add('correct');
        });
        setTimeout(()=>{ [...UI.choices.children].forEach(c=>c.classList.remove('correct','wrong')); }, 260);
      }
    }

    function flash(cssColor){
      const wrap = document.querySelector('.wrap');
      const prev = wrap.style.boxShadow;
      wrap.style.boxShadow = `0 0 0 4px color-mix(in oklab, ${cssColor} 30%, transparent), var(--shadow)`;
      setTimeout(()=> wrap.style.boxShadow = prev, 220);
    }

    function start(){
      state.running=true; state.paused=false; state.t=60; state.score=0; state.streak=0;
      UI.score.textContent='0'; UI.streak.textContent='0'; UI.time.textContent='60'; UI.res.textContent='';
      hide(UI.menu); hide(UI.over); show(UI.game);
      renderQuestion();
      tick();
    }

    function gameOver(){
      state.running=false; clearTimeout(state.timer);
      UI.finalScore.textContent = state.score; UI.finalStreak.textContent = state.streak;
      if(state.score>state.best){ state.best=state.score; localStorage.setItem('mp_best', String(state.best)); }
      UI.best.textContent = state.best;
      hide(UI.game); show(UI.over);
    }

    function tick(){
      if(!state.running) return;
      if(!state.paused){
        state.t -= 1; UI.time.textContent = state.t;
        UI.bar.style.width = Math.max(0, (state.t/60)*100) + '%';
        if(state.t<=0) return gameOver();
      }
      state.timer = setTimeout(tick, 1000);
    }

    function pauseToggle(){
      if(!state.running) return; state.paused = !state.paused; toast(state.paused? 'Jeda' : 'Lanjut');
    }

    function play(audio){ try{ audio.currentTime=0; audio.volume=.7; audio.play(); }catch(e){} }

    // ===== Events =====
    controls.startBtn.onclick = start; controls.playBtn.onclick = start; controls.againBtn.onclick = start; controls.restartBtn.onclick = start;
    controls.pauseBtn.onclick = pauseToggle; controls.skipBtn.onclick = ()=>{ state.score=Math.max(0,state.score-1); UI.score.textContent=state.score; state.streak=0; UI.streak.textContent='0'; renderQuestion(); };
    controls.shareBtn.onclick = ()=>{ const text=`Skorku ${state.score} di Math Puzzle! Coba kalahkan ya!`; if(navigator.share) navigator.share({title:'Math Puzzle', text}); else { navigator.clipboard.writeText(text); alert('Teks disalin!'); } };

    controls.diff.onchange = e=>{ state.difficulty = Number(e.target.value); if(state.running) renderQuestion(); };
    controls.type.onchange = e=>{ state.kind = e.target.value; if(state.running) renderQuestion(); };

    controls.toggleSound.onclick = (e)=>{ state.sound=!state.sound; e.target.setAttribute('aria-pressed', state.sound); e.target.textContent = 'Suara: ' + (state.sound?'ON':'OFF'); };
    controls.toggleMode.onclick = (e)=>{
      state.mode = state.mode==='input'? 'choice':'input';
      e.target.textContent = 'Mode: ' + (state.mode==='input'? 'Isian':'Pilihan');
      if(state.running) renderQuestion();
    };

    // Enter to submit
    UI.ans.addEventListener('keydown', (e)=>{
      if(e.key==='Enter') submit();
    });

    // Keyboard shortcuts
    document.addEventListener('keydown', (e)=>{
      if(e.key===' '){ e.preventDefault(); pauseToggle(); }
      if(e.key.toLowerCase()==='n'){ start(); }
    }, {passive:false});

    // Cara main dialog
    controls.howBtn.onclick = ()=>{
      alert('Jawab sebanyak mungkin soal dalam 60 detik. \n\n‚Äî Pilih jenis soal (penjumlahan, pengurangan, perkalian, cari x, bandingkan).\n‚Äî Pilih mode Isian (ketik) atau Pilihan (4 opsi).\n‚Äî Tiap jawaban benar menaikkan streak dan bonus skor.\n‚Äî Lewati soal (‚àí1 poin) bila buntu. Spasi = jeda. Selamat bermain!');
    };

    // Init
    hide(UI.game); hide(UI.over); show(UI.menu);
  })();
  </script>
</body>
</html>
